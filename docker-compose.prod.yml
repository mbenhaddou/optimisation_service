version: "3.9"

services:
  postgres:
    restart: unless-stopped

  redis:
    restart: unless-stopped

  api:
    restart: unless-stopped
    command:
      ["uvicorn", "services.api_service.app.main:app", "--host", "0.0.0.0", "--port", "8000", "--workers", "${API_WORKERS:-2}"]

  worker:
    restart: unless-stopped
    command:
      ["celery", "-A", "services.worker_service.app.celery_app.celery_app", "worker", "--loglevel=info", "--concurrency", "${CELERY_CONCURRENCY:-2}"]

  web:
    restart: unless-stopped
